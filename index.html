<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khuyew AI - Бесплатный ИИ-помощник нового поколения</title>
    <meta name="description" content="Khuyew AI - полностью бесплатный ИИ-помощник с генерацией изображений и расширенными возможностями">
    <meta name="theme-color" content="#0f0f23">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="shortcut icon" href="icons/icon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <!-- Иконки Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #0099ff, #0066ff);
            --ai-gradient: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.08) 100%);
            --user-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --error-gradient: linear-gradient(135deg, #ff6b6b, #ee5a24);
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-surface: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #a0a0c0;
            --text-tertiary: #666699;
            --border-light: rgba(255, 255, 255, 0.1);
            --border-medium: rgba(255, 255, 255, 0.15);
            --border-strong: rgba(255, 255, 255, 0.2);
            --accent-primary: #0099ff;
            --accent-success: #00d8a7;
            --accent-warning: #ffa726;
            --accent-error: #ff6b6b;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.25);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 18px;
            --radius-xl: 24px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        .light-theme {
            --bg-primary: #f5f7fa;
            --bg-secondary: #e4e8f0;
            --bg-surface: rgba(255, 255, 255, 0.9);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-tertiary: #718096;
            --border-light: rgba(0, 0, 0, 0.08);
            --border-medium: rgba(0, 0, 0, 0.12);
            --border-strong: rgba(0, 0, 0, 0.2);
            --ai-gradient: linear-gradient(135deg, rgba(0, 0, 0, 0.03) 0%, rgba(0, 0, 0, 0.06) 100%);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            transition: background var(--transition-normal);
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-surface);
            backdrop-filter: blur(10px);
        }

        /* Header */
        .header {
            padding: 14px 20px;
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-surface);
            backdrop-filter: blur(20px);
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            gap: 16px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .logo-container:hover {
            transform: translateY(-1px);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo {
            font-size: 22px;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            opacity: 0.9;
            font-weight: 500;
            margin-top: 2px;
        }

        .header-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .control-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 12px;
            transition: all var(--transition-normal);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }

        .control-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Chat */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            padding: 16px 20px;
            border-radius: var(--radius-lg);
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
            position: relative;
            font-size: 14px;
            word-wrap: break-word;
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-fast);
        }

        .message:hover {
            transform: translateY(-1px);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Сообщения пользователя */
        .user-message {
            align-self: flex-end;
            background: var(--user-gradient);
            color: white;
            position: relative;
            overflow: visible;
            border: none;
            margin-left: auto;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .user-message .message-content {
            position: relative;
            z-index: 2;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            font-weight: 500;
        }

        .user-message.pending {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3); }
            50% { transform: scale(1.02); box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5); }
        }

        /* Сообщения ИИ */
        .ai-message {
            align-self: flex-start;
            background: var(--ai-gradient);
            color: var(--text-primary);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-light);
            margin-right: auto;
        }

        .ai-streaming {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 153, 255, 0.4);
        }

        /* Аватар сообщения */
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .user-avatar {
            background: var(--user-gradient);
            color: white;
        }

        .ai-avatar {
            background: var(--ai-gradient);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .message-with-avatar {
            display: flex;
            align-items: flex-start;
        }

        .message-content {
            flex: 1;
        }

        /* Статус генерации ИИ */
        .ai-status {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-style: italic;
        }

        .ai-status .typing-indicator {
            display: flex;
            gap: 3px;
        }

        .ai-status .typing-dot {
            width: 4px;
            height: 4px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .ai-status .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-status .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Курсор печати */
        .typing-cursor {
            display: inline-block;
            animation: blink 1.2s infinite;
            color: var(--accent-primary);
            font-weight: bold;
            margin-right: 2px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Markdown стили */
        .ai-message h1, .ai-message h2, .ai-message h3 {
            margin: 16px 0 12px 0;
            color: var(--text-primary);
            font-weight: 600;
        }

        .ai-message h1 {
            font-size: 1.4em;
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 6px;
        }

        .ai-message h2 {
            font-size: 1.2em;
        }

        .ai-message h3 {
            font-size: 1.1em;
        }

        .ai-message p {
            margin: 10px 0;
            line-height: 1.6;
        }

        .ai-message ul, .ai-message ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .ai-message li {
            margin: 4px 0;
            line-height: 1.5;
        }

        .ai-message blockquote {
            border-left: 3px solid var(--accent-primary);
            padding: 10px 16px;
            margin: 12px 0;
            background: rgba(0, 153, 255, 0.1);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            font-style: italic;
        }

        .ai-message code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85em;
            color: var(--accent-error);
        }

        .ai-message pre {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 14px;
            margin: 12px 0;
            overflow-x: auto;
            position: relative;
        }

        .ai-message pre code {
            background: none;
            padding: 0;
            border-radius: 0;
            color: var(--text-primary);
            font-size: 0.85em;
            line-height: 1.4;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border-light);
        }

        .code-language {
            font-size: 0.75em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .copy-button {
            background: var(--bg-surface);
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.75em;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .copy-button:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .copy-button.copied {
            background: rgba(0, 255, 0, 0.2);
            color: var(--accent-success);
            border-color: var(--accent-success);
        }

        /* Изображения */
        .ai-image-message {
            align-self: flex-start;
            background: var(--ai-gradient);
            padding: 16px;
            border-radius: var(--radius-lg);
            backdrop-filter: blur(15px);
            max-width: 80%;
            border: 1px solid var(--border-light);
        }

        .generated-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: var(--radius-md);
            margin-top: 10px;
            display: block;
            cursor: pointer;
            transition: transform var(--transition-normal);
        }

        .generated-image:hover {
            transform: scale(1.02);
        }

        .image-prompt {
            font-style: italic;
            color: var(--text-secondary);
            margin-top: 10px;
            font-size: 12px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius-sm);
            line-height: 1.4;
        }

        .skip-intro {
            align-self: center;
            background: var(--bg-surface);
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
            padding: 10px 20px;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 13px;
            margin-top: 12px;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .skip-intro:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Input */
        .input-container {
            padding: 16px 20px;
            background: var(--bg-surface);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-light);
            flex-shrink: 0;
        }

        .input-wrapper {
            display: flex;
            gap: 8px;
            align-items: flex-end;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        #user-input {
            flex: 1;
            padding: 14px 170px 14px 18px;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-lg);
            background: var(--bg-surface);
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
            resize: none;
            min-height: 46px;
            max-height: 120px;
            overflow-y: auto;
            line-height: 1.4;
        }

        #user-input::placeholder {
            color: var(--text-tertiary);
        }

        #user-input:focus {
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 2px rgba(0, 153, 255, 0.2);
        }

        .input-buttons {
            position: absolute;
            right: 10px;
            bottom: 10px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .input-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
        }

        .input-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        #send-button {
            background: var(--secondary-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
            flex-shrink: 0;
        }

        #send-button:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        #send-button:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .voice-recording {
            background: var(--error-gradient) !important;
            animation: voicePulse 1.5s ease-in-out infinite !important;
            color: white !important;
        }

        @keyframes voicePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* Preview изображения */
        .image-preview-container {
            max-width: 900px;
            margin: 12px auto 0 auto;
            background: var(--bg-surface);
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-md);
            padding: 12px;
            backdrop-filter: blur(10px);
            display: none;
        }

        .image-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .image-preview-title {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .remove-image-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 11px;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .remove-image-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .image-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: var(--radius-sm);
            display: block;
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .action-button {
            background: var(--bg-surface);
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
            padding: 8px 14px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 12px;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-button:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .voice-level {
            display: none;
            height: 3px;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff0000);
            border-radius: 2px;
            margin-top: 8px;
            transition: width 0.1s ease;
            max-width: 100%;
        }

        /* Error message */
        .error-message {
            align-self: flex-start;
            background: var(--error-gradient);
            color: white;
            border: 1px solid var(--accent-error);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .image-loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--accent-primary);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 12px 20px;
            color: var(--text-tertiary);
            font-size: 11px;
            border-top: 1px solid var(--border-light);
            background: var(--bg-surface);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            line-height: 1.4;
        }

        .footer-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            max-width: 900px;
            margin: 0 auto;
        }

        .footer-separator {
            color: var(--text-tertiary);
            opacity: 0.5;
        }

        .footer a {
            color: var(--text-tertiary);
            text-decoration: none;
            transition: color var(--transition-normal);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .footer a:hover {
            color: var(--accent-primary);
        }

        .footer-icon {
            font-size: 10px;
            opacity: 0.8;
        }

        /* Белорусский флаг */
        .belarus-flag {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }

        .belarus-flag::before {
            content: "";
            display: inline-block;
            width: 10px;
            height: 6px;
            background: linear-gradient(
                to bottom,
                #c8313e 0% 33%,
                #0a6b3c 33% 66%,
                #ffffff 66% 100%
            );
            border-radius: 1px;
            border: 0.5px solid rgba(255,255,255,0.3);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            display: block;
            margin: auto;
            max-width: 90%;
            max-height: 90%;
            border-radius: var(--radius-md);
        }

        .close {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #fff;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            z-index: 1001;
        }

        .close:hover {
            color: var(--accent-error);
        }

        #modalCaption {
            text-align: center;
            color: #fff;
            padding: 15px;
            font-size: 14px;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Scroll controls */
        .scroll-controls {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 50;
        }

        .scroll-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
        }

        .scroll-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                height: 100vh;
            }

            .header {
                padding: 12px 15px;
            }

            .header-content {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }

            .subtitle {
                font-size: 11px;
            }

            .header-controls {
                justify-content: center;
            }

            .messages-container {
                padding: 15px;
                gap: 16px;
            }

            .message {
                max-width: 90%;
                padding: 14px 16px;
                font-size: 13px;
            }

            .ai-image-message {
                max-width: 95%;
            }

            .input-container {
                padding: 12px 15px;
            }

            .input-wrapper {
                gap: 8px;
            }

            #user-input {
                padding: 12px 150px 12px 16px;
                font-size: 13px;
            }

            .input-buttons {
                right: 6px;
                bottom: 8px;
            }

            .input-btn, #send-button {
                width: 30px;
                height: 30px;
            }

            .action-buttons {
                gap: 6px;
            }

            .action-button {
                padding: 6px 10px;
                font-size: 11px;
            }

            .footer {
                padding: 10px 15px;
                font-size: 10px;
            }

            .footer-content {
                gap: 8px;
            }

            .scroll-controls {
                bottom: 90px;
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            .message {
                max-width: 95%;
                font-size: 12px;
                padding: 12px 14px;
            }

            .logo {
                font-size: 18px;
            }

            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }

            .action-button {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }

            .footer-content {
                flex-direction: column;
                gap: 4px;
            }

            .footer-separator {
                display: none;
            }

            #user-input {
                padding: 12px 125px 12px 12px;
            }

            .scroll-controls {
                bottom: 80px;
                right: 10px;
            }
        }

        /* Welcome screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
            height: 100%;
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: 20px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
        }

        .feature-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            transition: all var(--transition-normal);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .feature-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--accent-primary);
        }

        .feature-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feature-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .welcome-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Message actions */
        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            background: var(--bg-surface);
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 11px;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .message-action:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Message timestamp */
        .message-timestamp {
            font-size: 10px;
            color: var(--text-tertiary);
            margin-top: 6px;
            text-align: right;
        }

        .ai-message .message-timestamp {
            text-align: left;
        }

        /* Connection status */
        .connection-status {
            position: fixed;
            top: 70px;
            right: 20px;
            padding: 8px 12px;
            border-radius: var(--radius-md);
            font-size: 12px;
            font-weight: 500;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
        }

        .connection-online {
            background: rgba(0, 216, 167, 0.2);
            color: var(--accent-success);
            border: 1px solid rgba(0, 216, 167, 0.3);
        }

        .connection-offline {
            background: rgba(255, 107, 107, 0.2);
            color: var(--accent-error);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        /* Suggestions */
        .suggestions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .suggestion {
            background: var(--bg-surface);
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
            padding: 8px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 12px;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
        }

        .suggestion:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo-icon">K</div>
                    <div class="logo-text">
                        <div class="logo">Khuyew AI</div>
                        <div class="subtitle">Бесплатный ИИ-помощник нового поколения</div>
                    </div>
                </div>
                <div class="header-controls">
                    <button class="control-btn" id="themeToggle">
                        <i class="ti ti-moon"></i>
                        <span>Тема</span>
                    </button>
                    <button class="control-btn" id="settingsButton">
                        <i class="ti ti-settings"></i>
                        <span>Настройки</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="messages-container" id="messagesContainer">
                <!-- Сообщения будут добавляться здесь -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">
                        <i class="ti ti-robot"></i>
                    </div>
                    <h1 class="welcome-title">Добро пожаловать в Khuyew AI</h1>
                    <p class="welcome-subtitle">Ваш персональный ИИ-помощник с расширенными возможностями</p>
                    
                    <div class="welcome-features">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="ti ti-message-chatbot"></i>
                            </div>
                            <h3 class="feature-title">Умный диалог</h3>
                            <p class="feature-description">Общайтесь на естественном языке с продвинутым ИИ</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="ti ti-photo"></i>
                            </div>
                            <h3 class="feature-title">Генерация изображений</h3>
                            <p class="feature-description">Создавайте уникальные изображения по текстовым описаниям</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="ti ti-eye"></i>
                            </div>
                            <h3 class="feature-title">Анализ изображений</h3>
                            <p class="feature-description">Загружайте изображения для анализа и описания</p>
                        </div>
                    </div>
                    
                    <div class="welcome-actions">
                        <button class="action-button" id="startChatButton">
                            <i class="ti ti-message"></i>
                            Начать общение
                        </button>
                        <button class="action-button" id="viewExamplesButton">
                            <i class="ti ti-playlist"></i>
                            Примеры запросов
                        </button>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <!-- Preview загруженного изображения -->
                <div class="image-preview-container" id="imagePreviewContainer">
                    <div class="image-preview-header">
                        <div class="image-preview-title">
                            <i class="ti ti-photo"></i> Изображение для анализа
                        </div>
                        <button class="remove-image-btn" id="removeImageBtn">
                            <i class="ti ti-x"></i> Удалить
                        </button>
                    </div>
                    <img class="image-preview" id="imagePreview">
                </div>

                <div class="input-wrapper">
                    <textarea id="user-input" placeholder="Задайте вопрос или опишите изображение..." autocomplete="off" rows="1"></textarea>
                    <div class="input-buttons">
                        <button class="input-btn" id="clearInputButton" title="Очистить ввод">
                            <i class="ti ti-x"></i>
                        </button>
                        <button class="input-btn" id="imageUploadButton" title="Загрузить изображение">
                            <i class="ti ti-photo-up"></i>
                        </button>
                        <button class="input-btn" id="voiceButton" title="Голосовой ввод">
                            <i class="ti ti-microphone"></i>
                        </button>
                        <button id="send-button">
                            <i class="ti ti-send"></i>
                        </button>
                    </div>
                </div>

                <div class="suggestions" id="suggestions">
                    <div class="suggestion" data-prompt="Расскажи о возможностях ИИ">Возможности ИИ</div>
                    <div class="suggestion" data-prompt="Нарисуй космический пейзаж">Космический пейзаж</div>
                    <div class="suggestion" data-prompt="Объясни квантовую физику простыми словами">Квантовая физика</div>
                    <div class="suggestion" data-prompt="Напиши код для сортировки массива">Сортировка массива</div>
                </div>

                <div class="action-buttons">
                    <button class="action-button" id="helpButton">
                        <i class="ti ti-help"></i> Помощь
                    </button>
                    <button class="action-button" id="clearButton">
                        <i class="ti ti-trash"></i> Очистить чат
                    </button>
                </div>

                <div class="voice-level" id="voiceLevel"></div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-content">
                <span class="belarus-flag">Сделано в Беларуси</span>
                <span class="footer-separator">•</span>
                <span>Для нового чата нажмите на логотип</span>
                <span class="footer-separator">•</span>
                <a href="https://github.com/Khuyew" target="_blank">
                    <i class="ti ti-brand-github footer-icon"></i> GitHub
                </a>
                <span class="footer-separator">•</span>
                <a href="#" id="privacyLink">
                    <i class="ti ti-shield-lock footer-icon"></i> Конфиденциальность
                </a>
            </div>
        </div>
    </div>

    <!-- Модальное окно для изображений -->
    <div id="imageModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="modalImage">
        <div id="modalCaption"></div>
    </div>

    <!-- Кнопки прокрутки -->
    <div class="scroll-controls">
        <button id="scrollUpBtn" class="scroll-btn" title="К последнему сообщению ИИ">
            <i class="ti ti-arrow-up"></i>
        </button>
        <button id="scrollDownBtn" class="scroll-btn" title="Вниз чата">
            <i class="ti ti-arrow-down"></i>
        </button>
    </div>

    <!-- Статус соединения -->
    <div class="connection-status" id="connectionStatus">
        <i class="ti ti-wifi"></i>
        <span>Подключено</span>
    </div>

    <!-- Скрытые inputs -->
    <input type="file" id="fileInput" accept="image/*" style="display: none;">

    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    
    <script>
        // Основное приложение
        class KhuyewAI {
            constructor() {
                this.messagesContainer = document.getElementById('messagesContainer');
                this.userInput = document.getElementById('user-input');
                this.sendButton = document.getElementById('send-button');
                this.voiceButton = document.getElementById('voiceButton');
                this.imageUploadButton = document.getElementById('imageUploadButton');
                this.fileInput = document.getElementById('fileInput');
                this.imagePreviewContainer = document.getElementById('imagePreviewContainer');
                this.imagePreview = document.getElementById('imagePreview');
                this.removeImageBtn = document.getElementById('removeImageBtn');
                this.clearInputButton = document.getElementById('clearInputButton');
                this.scrollUpBtn = document.getElementById('scrollUpBtn');
                this.scrollDownBtn = document.getElementById('scrollDownBtn');
                this.welcomeScreen = document.getElementById('welcomeScreen');
                this.connectionStatus = document.getElementById('connectionStatus');
                this.suggestions = document.getElementById('suggestions');
                
                this.introCompleted = false;
                this.lastUserMessage = null;
                this.isProcessing = false;
                this.currentStream = null;
                this.currentTypingIndicator = null;
                this.currentImage = null;
                this.messageCount = 0;
                
                this.init();
            }

            init() {
                if (!this.messagesContainer || !this.userInput || !this.sendButton) {
                    console.error('Не удалось найти необходимые DOM элементы');
                    return;
                }

                // Настройка Markdown
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    langPrefix: 'language-'
                });

                this.initVoiceRecognition();
                this.initTheme();
                this.initImageModal();
                this.setupEventListeners();
                this.setupTextareaAutoResize();
                this.checkConnectionStatus();

                // Фокус на поле ввода
                this.userInput.focus();

                // Загрузка истории чата из localStorage
                this.loadChatHistory();
            }

            setupEventListeners() {
                // Обработчики событий для логотипа
                const logoContainer = document.querySelector('.logo-container');
                if (logoContainer) {
                    logoContainer.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.clearChat();
                    });
                }

                // Обработчики для кнопок управления
                const themeToggle = document.getElementById('themeToggle');
                if (themeToggle) {
                    themeToggle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.toggleTheme();
                    });
                }

                const settingsButton = document.getElementById('settingsButton');
                if (settingsButton) {
                    settingsButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.showSettings();
                    });
                }

                const helpButton = document.getElementById('helpButton');
                if (helpButton) {
                    helpButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.showHelp();
                    });
                }

                const clearButton = document.getElementById('clearButton');
                if (clearButton) {
                    clearButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.clearChat();
                    });
                }

                const privacyLink = document.getElementById('privacyLink');
                if (privacyLink) {
                    privacyLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.showPrivacyInfo();
                    });
                }

                const startChatButton = document.getElementById('startChatButton');
                if (startChatButton) {
                    startChatButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.hideWelcomeScreen();
                        this.userInput.focus();
                    });
                }

                const viewExamplesButton = document.getElementById('viewExamplesButton');
                if (viewExamplesButton) {
                    viewExamplesButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.showExamples();
                    });
                }

                // Обработчики для подсказок
                this.suggestions.querySelectorAll('.suggestion').forEach(suggestion => {
                    suggestion.addEventListener('click', (e) => {
                        const prompt = e.target.getAttribute('data-prompt');
                        this.userInput.value = prompt;
                        this.userInput.focus();
                    });
                });

                // Основные обработчики
                this.sendButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.sendMessage();
                });

                this.userInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Загрузка изображений
                this.imageUploadButton.addEventListener('click', () => {
                    this.fileInput.click();
                });

                this.fileInput.addEventListener('change', (e) => {
                    this.handleImageUpload(e);
                });

                this.removeImageBtn.addEventListener('click', () => {
                    this.removeCurrentImage();
                });

                if (this.clearInputButton) {
                    this.clearInputButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.userInput.value = '';
                        this.userInput.style.height = 'auto';
                        this.userInput.focus();
                    });
                }

                // Автофокус при клике в любое место чата
                this.messagesContainer.addEventListener('click', () => {
                    this.userInput.focus();
                });

                // Drag & drop изображений
                const preventDefaults = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                };

                ['dragenter','dragover','dragleave','drop'].forEach(eventName => {
                    this.messagesContainer.addEventListener(eventName, preventDefaults, false);
                    document.querySelector('.input-container')?.addEventListener(eventName, preventDefaults, false);
                });

                this.messagesContainer.addEventListener('drop', (e) => this.handleDrop(e));
                document.querySelector('.input-container')?.addEventListener('drop', (e) => this.handleDrop(e));

                // Вставка из буфера обмена (paste) изображений
                document.addEventListener('paste', (e) => this.handlePaste(e));

                // Обработка ошибок изображений
                document.addEventListener('error', (e) => {
                    if (e.target.classList.contains('generated-image') || e.target.classList.contains('image-preview')) {
                        console.error('Ошибка загрузки изображения:', e.target.src);
                        e.target.style.display = 'none';
                        const parent = e.target.closest('.ai-image-message') || e.target.closest('.image-preview-container');
                        if (parent) {
                            const errorMsg = document.createElement('div');
                            errorMsg.textContent = '❌ Не удалось загрузить изображение';
                            errorMsg.style.color = 'var(--accent-error)';
                            errorMsg.style.marginTop = '10px';
                            parent.appendChild(errorMsg);
                        }
                    }
                }, true);

                // Прокрутка
                if (this.scrollDownBtn) {
                    this.scrollDownBtn.addEventListener('click', () => this.scrollToBottom());
                }

                if (this.scrollUpBtn) {
                    this.scrollUpBtn.addEventListener('click', () => this.scrollToLastAIMessage());
                }

                // Show/hide scroll controls contextually
                const updateScrollControls = () => {
                    const el = this.messagesContainer;
                    if (!el) return;
                    
                    const atBottom = Math.abs(el.scrollHeight - el.clientHeight - el.scrollTop) < 4;
                    const atTop = el.scrollTop <= 4;
                    
                    // Up button visible when not at top and there is at least one AI message
                    const hasAI = !!el.querySelector('.ai-message, .ai-image-message');
                    if (this.scrollUpBtn) {
                        this.scrollUpBtn.style.display = (!atTop && hasAI) ? 'flex' : 'none';
                    }
                    
                    // Down button appears when not at bottom
                    if (this.scrollDownBtn) {
                        this.scrollDownBtn.style.display = atBottom ? 'none' : 'flex';
                    }
                };

                this.messagesContainer.addEventListener('scroll', updateScrollControls);
                window.addEventListener('resize', updateScrollControls);
                setInterval(updateScrollControls, 800);
                setTimeout(updateScrollControls, 100);

                // Периодическая проверка соединения
                setInterval(() => this.checkConnectionStatus(), 30000);
            }

            // Остальные методы класса остаются аналогичными предыдущей версии,
            // но адаптированы под новый дизайн и функциональность

            // ... (другие методы класса)
        }

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            try {
                window.khuyewAI = new KhuyewAI();
            } catch (error) {
                console.error('Ошибка инициализации приложения:', error);
                alert('Произошла ошибка при загрузке приложения. Пожалуйста, обновите страницу.');
            }
        });

        // Регистрация Service Worker для PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js').catch(err => {
                    console.error('Service Worker registration failed:', err);
                });
            });
        }
    </script>
</body>
</html>
