<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>KHAI - Первый белорусский ИИ-помощник</title>
    
    <!-- Мета-теги для PWA -->
    <meta name="description" content="KHAI - первый белорусский искусственный интеллект. Бесплатный ИИ-помощник с поддержкой голоса и изображений.">
    <meta name="keywords" content="искусственный интеллект, AI, чат, Беларусь, KHAI">
    <meta name="author" content="KHAI Team">
    
    <!-- PWA -->
    <meta name="theme-color" content="#0a0a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="KHAI">
    
    <!-- Favicon и иконки -->
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Предзагрузка критических ресурсов -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="script.js" as="script">
    
    <!-- Стили -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Безопасная загрузка внешних скриптов -->
    <script src="https://js.puter.com/v2/" crossorigin="anonymous" defer></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "KHAI - Первый белорусский ИИ-помощник",
        "description": "Бесплатный искусственный интеллект для общения и помощи",
        "url": "https://khai.ai",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</head>
<body>
    <!-- Error Boundary -->
    <div id="error-boundary" class="error-boundary" style="display: none;">
        <div class="error-content">
            <h2>⚠️ Временные неполадки</h2>
            <p>KHAI временно недоступен. Пожалуйста, обновите страницу.</p>
            <button onclick="window.location.reload()" class="retry-btn">
                <i class="ti ti-refresh"></i>
                Обновить
            </button>
        </div>
    </div>

    <!-- Основной контейнер -->
    <div class="app-container" id="appContainer">
        <!-- Хедер -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <button class="control-btn menu-toggle" id="menuToggle" aria-label="Меню">
                        <i class="ti ti-menu-2"></i>
                    </button>
                    <h1 class="logo" id="appLogo">KHAI</h1>
                </div>
                
                <div class="header-center">
                    <span class="current-chat" id="currentChatName">Новый чат</span>
                </div>
                
                <div class="header-right">
                    <select class="model-select" id="modelSelect" aria-label="Выбор модели ИИ">
                        <option value="gpt-4">GPT-4 Turbo</option>
                        <option value="gpt-3.5">GPT-3.5 Turbo</option>
                        <option value="claude-2">Claude 2</option>
                        <option value="llama-2">Llama 2</option>
                    </select>
                    
                    <button class="control-btn theme-toggle" id="themeToggle" aria-label="Переключить тему">
                        <i class="ti ti-sun" data-theme-icon="light"></i>
                        <i class="ti ti-moon" data-theme-icon="dark" style="display: none;"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Боковое меню -->
        <aside class="sidebar-menu" id="sidebarMenu">
            <div class="sidebar-header">
                <h3>Чаты</h3>
                <button class="control-btn close-menu" id="closeMenu" aria-label="Закрыть меню">
                    <i class="ti ti-x"></i>
                </button>
            </div>
            
            <div class="chat-list" id="chatList">
                <!-- Список чатов будет генерироваться динамически -->
            </div>
            
            <div class="sidebar-footer">
                <button class="action-btn new-chat-btn" id="newChatBtn">
                    <i class="ti ti-plus"></i>
                    Новый чат
                </button>
                
                <div class="user-section">
                    <div class="user-avatar">
                        <i class="ti ti-user"></i>
                    </div>
                    <span class="user-name">Пользователь</span>
                </div>
            </div>
        </aside>

        <!-- Overlay для меню -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Основной контент -->
        <main class="main-content">
            <div class="messages-container" id="messagesContainer" role="log" aria-live="polite">
                <!-- Сообщения будут добавляться динамически -->
            </div>
            
            <!-- Индикатор набора текста -->
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span class="typing-text">KHAI печатает...</span>
            </div>
        </main>

        <!-- Секция ввода -->
        <section class="input-section">
            <div class="input-wrapper">
                <textarea 
                    id="userInput" 
                    placeholder="Напишите сообщение..." 
                    aria-label="Введите ваше сообщение"
                    rows="1"
                    maxlength="4000"
                ></textarea>
                
                <div class="input-actions">
                    <button class="input-btn voice-btn" id="voiceBtn" aria-label="Голосовой ввод">
                        <i class="ti ti-microphone"></i>
                    </button>
                    
                    <button class="input-btn image-btn" id="imageBtn" aria-label="Прикрепить изображение">
                        <i class="ti ti-photo"></i>
                    </button>
                </div>
                
                <button class="send-btn" id="sendBtn" aria-label="Отправить сообщение">
                    <i class="ti ti-send"></i>
                </button>
            </div>
            
            <div class="input-footer">
                <span class="char-counter" id="charCounter">0/4000</span>
                <span class="security-badge">
                    <i class="ti ti-shield-check"></i>
                    Защищено
                </span>
            </div>
        </section>
    </div>

    <!-- Уведомления -->
    <div class="notifications-container" id="notificationsContainer"></div>

    <!-- Модальные окна -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;">
        <div class="modal-content" role="dialog" aria-modal="true">
            <!-- Контент модальных окон -->
        </div>
    </div>

    <!-- Скрипты -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js" integrity="sha512-L9vVwZ0eXbVlRgZvO+WJzT16i4Kv9T1c0F6YhO5N4C8m3q6q5q5q5q5q5q5q5q5q5q5q5q5q5q5q5q5q5q5q5q5q" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7h3tkW1Z6C5f6l5+7f5l5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5f5" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Основной скрипт приложения -->
    <script src="script.js"></script>
    
    <!-- Аналитика (опционально) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: 'KHAI AI Chat',
            transport_type: 'beacon'
        });
    </script>
</body>
</html>
