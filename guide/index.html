<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHAI Assistant - Интерактивный гайд</title>
    <style>
        /* Стили гайда */
        .guide-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        .guide-container {
            background: #1e1e2e;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .guide-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .guide-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .guide-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
        }
        
        .guide-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .guide-content {
            padding: 20px;
        }
        
        .guide-step {
            margin-bottom: 20px;
        }
        
        .guide-step-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #ffffff;
        }
        
        .guide-step-description {
            font-size: 14px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .guide-highlight {
            position: absolute;
            border: 2px solid #0099ff;
            border-radius: 8px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.3);
            z-index: 10001;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .guide-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .guide-progress {
            display: flex;
            gap: 5px;
        }
        
        .guide-progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: background 0.3s ease;
        }
        
        .guide-progress-dot.active {
            background: #0099ff;
        }
        
        .guide-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .guide-btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        
        .guide-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .guide-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .guide-btn-primary {
            background: #0099ff;
            color: white;
        }
        
        .guide-btn-primary:hover {
            background: #0081e6;
        }
        
        .guide-btn-skip {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: inherit;
        }
        
        .guide-btn-skip:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .guide-element-highlight {
            box-shadow: 0 0 0 3px #0099ff !important;
            z-index: 10002 !important;
            position: relative;
            transition: box-shadow 0.3s ease;
        }

        /* Кнопка повторного показа гайда */
        .guide-restart-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #0099ff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(0, 153, 255, 0.3);
            z-index: 9999;
            transition: all 0.3s ease;
        }

        .guide-restart-btn:hover {
            background: #0081e6;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- Контейнер для гайда -->
    <div id="guideOverlay" class="guide-overlay">
        <div class="guide-container">
            <div class="guide-header">
                <div class="guide-title">Добро пожаловать в KHAI Assistant!</div>
                <button class="guide-close" id="guideCloseBtn">✕</button>
            </div>
            <div class="guide-content">
                <div class="guide-step" id="guideStepContent">
                    <!-- Содержимое шагов будет заполняться динамически -->
                </div>
            </div>
            <div class="guide-footer">
                <div class="guide-progress" id="guideProgress">
                    <!-- Прогресс будет заполнен динамически -->
                </div>
                <div class="guide-buttons">
                    <button class="guide-btn guide-btn-secondary" id="guidePrevBtn" style="display: none;">Назад</button>
                    <button class="guide-btn guide-btn-primary" id="guideNextBtn">Далее</button>
                    <button class="guide-btn-skip" id="guideSkipBtn">Пропустить</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Подсветка элементов -->
    <div id="guideHighlight" class="guide-highlight"></div>

    <!-- Кнопка повторного запуска гайда -->
    <button class="guide-restart-btn" id="guideRestartBtn" title="Показать гайд" style="display: none;">
        <i class="ti ti-help" style="font-size: 20px;"></i>
    </button>

    <script>
        // Определяем шаги гайда
        const guideSteps = [
            {
                title: "Добро пожаловать в KHAI Assistant!",
                description: "Это первый белорусский ИИ-помощник. Давайте познакомимся с основными функциями приложения.",
                element: null
            },
            {
                title: "Ввод сообщений",
                description: "Здесь вы можете вводить свои вопросы и запросы к ИИ. Просто начните печатать и нажмите кнопку отправки.",
                element: "#userInput"
            },
            {
                title: "Отправка сообщений",
                description: "Эта кнопка отправляет ваше сообщение ИИ. Также вы можете использовать клавишу Enter для быстрой отправки.",
                element: "#sendBtn"
            },
            {
                title: "Прикрепление файлов",
                description: "Нажмите эту кнопку, чтобы прикрепить изображения или текстовые файлы для анализа ИИ.",
                element: "#attachFileBtn"
            },
            {
                title: "Режимы работы",
                description: "Здесь вы можете переключаться между обычным режимом, генерацией голоса и изображений (в разработке).",
                element: ".action-buttons"
            },
            {
                title: "История чатов",
                description: "Откройте меню, чтобы просмотреть историю ваших чатов, создать новый или импортировать существующий.",
                element: "#menuToggle"
            },
            {
                title: "Выбор модели ИИ",
                description: "Нажмите эту кнопку, чтобы выбрать другую модель ИИ для общения.",
                element: "#modelSelectBtn"
            },
            {
                title: "Поиск по чату",
                description: "Используйте поиск, чтобы быстро найти нужные сообщения в длинных беседах.",
                element: "#headerSearch"
            },
            {
                title: "Навигация",
                description: "Эти кнопки помогут быстро перейти к последнему ответу ИИ или в конец чата.",
                element: ".minimap-navigation"
            },
            {
                title: "Готово к использованию!",
                description: "Теперь вы знакомы с основными функциями KHAI Assistant. Начните общение с ИИ прямо сейчас!",
                element: null
            }
        ];

        // Переменные состояния гайда
        let currentStep = 0;
        let guideActive = false;

        // Функция инициализации гайда
        function initGuide() {
            // Проверяем, нужно ли показывать гайд
            const hasSeenGuide = localStorage.getItem('khai_guide_seen');
            
            // Если гайд еще не показывался или пользователь находится на странице /guide
            if (!hasSeenGuide || window.location.pathname.includes('/guide')) {
                // Ждем немного, чтобы интерфейс успел загрузиться
                setTimeout(() => {
                    startGuide();
                }, 1000);
            } else {
                // Показываем кнопку для повторного запуска гайда
                showRestartButton();
            }
        }

        // Функция запуска гайда
        function startGuide() {
            if (guideActive) return;
            
            guideActive = true;
            currentStep = 0;
            
            // Показываем оверлей гайда
            document.getElementById('guideOverlay').style.display = 'flex';
            
            // Скрываем кнопку перезапуска
            document.getElementById('guideRestartBtn').style.display = 'none';
            
            // Обновляем отображение текущего шага
            updateGuideStep();
        }

        // Функция обновления текущего шага гайда
        function updateGuideStep() {
            const step = guideSteps[currentStep];
            const stepContent = document.getElementById('guideStepContent');
            const progressContainer = document.getElementById('guideProgress');
            const prevBtn = document.getElementById('guidePrevBtn');
            const nextBtn = document.getElementById('guideNextBtn');
            const highlight = document.getElementById('guideHighlight');
            
            // Обновляем содержимое шага
            stepContent.innerHTML = `
                <div class="guide-step-title">${step.title}</div>
                <div class="guide-step-description">${step.description}</div>
            `;
            
            // Обновляем прогресс
            progressContainer.innerHTML = '';
            guideSteps.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = `guide-progress-dot ${index === currentStep ? 'active' : ''}`;
                progressContainer.appendChild(dot);
            });
            
            // Обновляем кнопки навигации
            prevBtn.style.display = currentStep > 0 ? 'block' : 'none';
            nextBtn.textContent = currentStep === guideSteps.length - 1 ? 'Завершить' : 'Далее';
            
            // Обрабатываем подсветку элемента
            if (step.element) {
                const targetElement = document.querySelector(step.element);
                if (targetElement) {
                    // Показываем подсветку
                    const rect = targetElement.getBoundingClientRect();
                    highlight.style.display = 'block';
                    highlight.style.width = `${rect.width + 10}px`;
                    highlight.style.height = `${rect.height + 10}px`;
                    highlight.style.left = `${rect.left - 5}px`;
                    highlight.style.top = `${rect.top - 5}px`;
                    
                    // Добавляем класс подсветки к элементу
                    targetElement.classList.add('guide-element-highlight');
                    
                    // Прокручиваем к элементу, если он не виден
                    setTimeout(() => {
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                } else {
                    highlight.style.display = 'none';
                    console.warn('Элемент не найден:', step.element);
                }
            } else {
                highlight.style.display = 'none';
            }
            
            // Убираем подсветку с предыдущего элемента
            document.querySelectorAll('.guide-element-highlight').forEach(el => {
                if (step.element && el !== document.querySelector(step.element)) {
                    el.classList.remove('guide-element-highlight');
                }
            });
        }

        // Функция перехода к следующему шагу
        function nextStep() {
            // Убираем подсветку с текущего элемента
            if (guideSteps[currentStep].element) {
                const currentElement = document.querySelector(guideSteps[currentStep].element);
                if (currentElement) {
                    currentElement.classList.remove('guide-element-highlight');
                }
            }
            
            if (currentStep < guideSteps.length - 1) {
                currentStep++;
                updateGuideStep();
            } else {
                finishGuide();
            }
        }

        // Функция перехода к предыдущему шагу
        function prevStep() {
            // Убираем подсветку с текущего элемента
            if (guideSteps[currentStep].element) {
                const currentElement = document.querySelector(guideSteps[currentStep].element);
                if (currentElement) {
                    currentElement.classList.remove('guide-element-highlight');
                }
            }
            
            if (currentStep > 0) {
                currentStep--;
                updateGuideStep();
            }
        }

        // Функция завершения гайда
        function finishGuide() {
            guideActive = false;
            
            // Скрываем оверлей гайда
            document.getElementById('guideOverlay').style.display = 'none';
            document.getElementById('guideHighlight').style.display = 'none';
            
            // Убираем подсветку со всех элементов
            document.querySelectorAll('.guide-element-highlight').forEach(el => {
                el.classList.remove('guide-element-highlight');
            });
            
            // Сохраняем информацию о том, что гайд был показан
            localStorage.setItem('khai_guide_seen', 'true');
            
            // Показываем кнопку перезапуска
            showRestartButton();
            
            // Если мы на странице /guide, перенаправляем на главную
            if (window.location.pathname.includes('/guide')) {
                window.history.replaceState(null, null, window.location.pathname.replace('/guide', '/'));
            }
        }

        // Функция пропуска гайда
        function skipGuide() {
            finishGuide();
        }

        // Функция показа кнопки перезапуска гайда
        function showRestartButton() {
            document.getElementById('guideRestartBtn').style.display = 'flex';
        }

        // Инициализация гайда после загрузки DOM
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализируем гайд
            initGuide();
            
            // Назначаем обработчики событий
            document.getElementById('guideNextBtn').addEventListener('click', nextStep);
            document.getElementById('guidePrevBtn').addEventListener('click', prevStep);
            document.getElementById('guideSkipBtn').addEventListener('click', skipGuide);
            document.getElementById('guideCloseBtn').addEventListener('click', skipGuide);
            document.getElementById('guideRestartBtn').addEventListener('click', startGuide);
            
            // Обработка нажатия клавиши Esc для закрытия гайда
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && guideActive) {
                    skipGuide();
                }
            });
            
            // Обработка клика по оверлею для закрытия гайда
            document.getElementById('guideOverlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    skipGuide();
                }
            });
        });

        // Экспортируем функции для использования в основном приложении
        window.GuideManager = {
            startGuide,
            finishGuide,
            showRestartButton
        };
    </script>
</body>
</html>
